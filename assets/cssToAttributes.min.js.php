<?php

/*
 * CSS to Attributes addon for Bear Framework
 * https://github.com/ivopetkov/css-to-attributes-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
var cssToAttributes=void 0!==cssToAttributes?cssToAttributes:function(){var e=document.head,t="--css-to-attribute-".length,n=new RegExp("--css-to-attribute-.*?:","g"),i=[],o=[],r=[],s=[],u=[],a=-1!==document.cookie.indexOf("ivopetkov-css-to-attributes=debug"),c=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(4===r.type)c(r.cssRules);else if(1===r.type){var s=r.cssText;if(-1!==s.indexOf("--css-to-attribute-")){var u=r.selectorText,a=i.indexOf(u);-1===a&&(i.push(u),o.push([]),a=i.indexOf(u));for(var d=o[a],l=s.match(n),f=0;f<l.length;f++){var v=l[f].replace(":","").trim();-1===d.indexOf(v)&&d.push(v)}}}}},d=null,l=function(e){e&&!1===d||(d=e)},f=function(e){if(a){var t="cssToAttributes::updateObservedSelectorsList - "+(e?"use cache":"no cache");console.time(t)}for(var n=document.styleSheets,i=0;i<n.length;i++){var o=n[i],r=o.ownerNode.outerHTML;if(!e||void 0===u[i]||u[i]!==r){try{c(o.cssRules)}catch(e){}u[i]=r}}a&&console.timeEnd(t)},v=null,m=function(){v=!0},b=function(){if(a){var e="cssToAttributes::updateObservedElementsList";console.time(e)}for(var t=0;t<i.length;t++)for(var n=i[t],u=o[t],c=document.querySelectorAll(n),d=0;d<c.length;d++){var l=c[d],f=r.indexOf(l);-1===f&&(r.push(l),s.push([]),f=r.indexOf(l));for(var v=s[f],m=0;m<u.length;m++){var b=u[m];-1===v.indexOf(b)&&v.push(b)}}a&&console.timeEnd(e)},h=function(e){for(var t=["!",";","{","}",'"',"'"],n=0;n<t.length;n++){var i=t[n];e=e.split("\\"+i).join(i)}return e},g=null,p=function(){g=!0},w=function(){if(a){var e="cssToAttributes::updateObservedElements";console.time(e)}for(var n=[],i=0;i<r.length;i++){var o=r[i];if(document.contains(o)){for(var u=!1,c=s[i],d=getComputedStyle(o),l=0;l<c.length;l++){var f=c[l],v=h(d.getPropertyValue(f).trim()),m=f.substring(t);""===v?null!==o.getAttribute(m)&&(o.removeAttribute(m),u=!0):o.getAttribute(m)!==v&&(o.setAttribute(m,v),u=!0)}u&&n.push(o)}}if(n.length>0){var b=new Event("css-to-attributes-change");b.elements=n,window.dispatchEvent(b)}a&&console.timeEnd(e)};(window.addEventListener("resize",(function(){m(),p()})),window.addEventListener("load",(function(){l(!0),m(),p()})),window.addEventListener("orientationchange",(function(){m(),p()})),"undefined"!=typeof MutationObserver)&&new MutationObserver((function(t){for(var n=!1,i=!1,o=0;o<t.length;o++){var u=t[o],a=u.target;if(e.contains(a)){n=!0,i=!0;break}if(!i)if("attributes"===u.type){var c=r.indexOf(a);-1!==c?-1===s[c].indexOf("--css-to-attribute-"+u.attributeName)&&(i=!0):i=!0}else i=!0}n&&l(!0),i&&(m(),p())})).observe(document,{childList:!0,subtree:!0,attributes:!0});var O=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},A=function(){"loading"===document.readyState&&(l(!0),m(),p()),null!==d&&(f(d),d=null),null!==v&&(b(),v=null),null!==g&&(w(),g=null),O(A)};return A(),document.addEventListener("readystatechange",()=>{f(!1),b(),w()}),"complete"===document.readyState&&(f(!1),b(),w()),{run:function(e){f(void 0===e||!e),b(),w()}}}();
EOT;
